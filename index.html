<!DOCTYPE html>
<html lang="de" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA / App-Modus fÃ¼r iPad -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JuSchG App">
    
    <title>Jugendschutzgesetz - Interaktive FallprÃ¼fung</title>
    
    <!-- Tailwind CSS (mit Dark Mode Support) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: {} }
        }
    </script>
    
    <!-- FontAwesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Confetti Script fÃ¼r Gamification -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Modern Interactive Table (Traffic Light) --- */
        .traffic-light {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .traffic-light:active { transform: scale(0.92); box-shadow: none; }
        
        /* Light/Dark Mode Ampel-Farben */
        .state-neutral { background-color: #f1f5f9; color: #64748b; border: 1px solid #cbd5e1; }
        .dark .state-neutral { background-color: #1e293b; color: #94a3b8; border: 1px solid #334155; }
        
        .state-red { background-color: #fee2e2; color: #991b1b; border: 2px solid #ef4444; }
        .dark .state-red { background-color: #7f1d1d; color: #fca5a5; border: 2px solid #ef4444; }
        
        .state-green { background-color: #dcfce7; color: #166534; border: 2px solid #22c55e; }
        .dark .state-green { background-color: #14532d; color: #86efac; border: 2px solid #22c55e; }
        
        .state-yellow { background-color: #fef9c3; color: #854d0e; border: 2px solid #eab308; }
        .dark .state-yellow { background-color: #713f12; color: #fde047; border: 2px solid #eab308; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px); }
            75% { transform: translateX(6px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }

        /* --- Term Matching --- */
        .term-item { cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .term-item.selected {
            transform: scale(1.05) translateY(-2px);
            background-color: #eff6ff; border-color: #3b82f6; color: #1d4ed8;
            animation: pulse-ring 1.5s infinite;
        }
        .drop-zone { min-height: 70px; transition: all 0.2s ease; }
        .drop-zone.highlight { background-color: #f0fdf4; border-color: #22c55e; border-style: solid; transform: scale(1.02); }
        .dark .drop-zone.highlight { background-color: #052e16; }

        /* --- iPad Forms --- */
        textarea, input[type="radio"] { appearance: none; -webkit-appearance: none; }
        .quiz-radio { width: 1.25rem; height: 1.25rem; border: 2px solid #cbd5e1; border-radius: 50%; outline: none; position: relative; transition: all 0.2s; }
        .dark .quiz-radio { border-color: #475569; }
        .quiz-radio:checked { border-color: #3b82f6; background-color: white; }
        .dark .quiz-radio:checked { background-color: #1e293b; }
        .quiz-radio:checked::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 0.625rem; height: 0.625rem; background-color: #3b82f6; border-radius: 50%; }

        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        
        /* Safe Areas (iPad Pro) */
        .pt-safe { padding-top: env(safe-area-inset-top); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

        /* Save Badge Fade */
        .fade-out { opacity: 0; transition: opacity 1s ease-in-out; }

        @media print {
            body * { visibility: hidden; }
            #print-container, #print-container * { visibility: visible; }
            #print-container { position: absolute; left: 0; top: 0; width: 100%; background: white; padding: 0; color: black; }
            .page-break { page-break-before: always; }
            .no-print { display: none !important; }
            @page { size: A4; margin: 2cm; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 pb-32">

    <!-- Print Container -->
    <div id="print-container" class="hidden absolute top-0 left-0 w-full bg-white z-50 prose max-w-none text-black"></div>

    <!-- ğŸ† Fortschrittsbalken -->
    <div class="fixed top-0 left-0 w-full h-1.5 bg-slate-200 dark:bg-slate-800 z-50 pt-safe no-print">
        <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-500 ease-out w-0"></div>
    </div>

    <!-- ğŸŒ™ Dark Mode Toggle -->
    <button id="themeToggle" class="fixed top-4 right-4 z-40 bg-white/80 dark:bg-slate-800/80 backdrop-blur-md border border-slate-200 dark:border-slate-700 p-3 rounded-full shadow-lg text-slate-700 dark:text-yellow-400 text-xl no-print hover:scale-110 transition-transform">
        <i class="fa-solid fa-moon dark:hidden"></i>
        <i class="fa-solid fa-sun hidden dark:block"></i>
    </button>

    <!-- Main Content -->
    <main class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8 mt-4 no-print">
        
        <!-- Header Image -->
        <div class="w-full h-56 md:h-72 rounded-3xl overflow-hidden mb-10 shadow-xl relative bg-slate-900 flex items-center justify-center border border-slate-200 dark:border-slate-800">
            <img src="https://images.unsplash.com/photo-1589829085413-56de8ae18c73?auto=format&fit=crop&q=80&w=2000" alt="Gesetzestexte" class="w-full h-full object-cover opacity-40 absolute inset-0 mix-blend-overlay">
            <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/40 to-transparent flex items-end p-6 md:p-10">
                <div class="z-10 relative">
                    <span class="bg-blue-600/30 backdrop-blur-md border border-blue-400/30 text-blue-100 text-xs font-bold px-4 py-1.5 rounded-full uppercase tracking-wider mb-4 inline-block shadow-sm">Klasse 10 | Modul Recht</span>
                    <h1 class="text-3xl md:text-5xl font-bold text-white mb-3 tracking-tight">Das Jugendschutzgesetz</h1>
                    <p class="text-blue-200 font-medium text-lg md:text-xl max-w-2xl">Warum wir Regeln brauchen und wie sie in der RealitÃ¤t aussehen</p>
                </div>
            </div>
        </div>

        <!-- Section 1: Einstieg (Dorf ohne Regeln) -->
        <section class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 md:p-10 mb-8 transition-colors">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold flex items-center"><span class="bg-amber-100 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400 w-10 h-10 rounded-xl flex items-center justify-center mr-4"><i class="fa-solid fa-book-open"></i></span>Einstieg: Das Dorf ohne Regeln</h2>
                <button class="tts-btn text-amber-500 hover:bg-amber-50 dark:hover:bg-slate-700 w-10 h-10 rounded-full transition flex-shrink-0" data-read="storyText"><i class="fa-solid fa-volume-high"></i></button>
            </div>
            
            <div id="storyText" class="prose dark:prose-invert max-w-none text-slate-700 dark:text-slate-300 text-base md:text-lg leading-relaxed space-y-4 bg-amber-50/50 dark:bg-amber-900/10 p-6 md:p-8 rounded-2xl border border-amber-100 dark:border-amber-800/30 mb-8 italic shadow-inner">
                <p>Die Leute im Dorf hatten die Regeln satt. Alles war vorgeschrieben: wann sie aufstehen, wann sie zur Arbeit gehen sollten, wann Sonntag war und wann Werktag. Den SchÃ¼lern wurde vorgeschrieben, wann die Schule beginnt, dass sie ein Taschentuch bei sich tragen und zu Hause die ZÃ¤hne putzen sollen. Es gab Regeln, wie man Ã¼ber die StraÃŸe geht, wie lange man am Abend duschen darf und wie lange man Klavier spielen darf.</p>
                <p>Es waren wirklich viele Vorschriften, und die Leute beschlossen: <strong>Von heute an gelten keine Regeln mehr.</strong> Das war schÃ¶n!</p>
                <p>Die Schule war natÃ¼rlich leer, weil alle Kinder baden gingen. Die Leute stellten die Stubentische auf die StraÃŸe, weil es dort so sonnig war. Die Jungen drehten die Stereoanlage auf und lieÃŸen sie 24 Stunden laufen. Als Peter aus dem Wasser stieg, fand er seine Hosen nicht mehr. Klaus hatte sie angezogen. â€Es gibt keine Regeln mehr!â€œ rief er. â€Tja, ohne Regeln kann ich mir meine Hose auch wiederholen!â€œ sagte Peter und schon begann eine wilde PrÃ¼gelei. Obwohl Peter dabei Klaus die Nase brach, blieb sein Handeln ohne Folgen.</p>
                <p>Maja fand in ihrem Zimmer die kleine Esther vom oberen Stock. Sie war gerade dabei, Majas Lieblingspuppe zu operieren. â€Was machst du da?â€œ fragte Maja entsetzt. â€Es gibt keine Regeln mehrâ€œ, antwortete Esther darauf, packte Majas Puppen zusammen und ging davon. Als die Leute im Dorf einschlafen wollten, schmetterten die Lautsprecher noch immer. Viele fanden ihr Geld nicht mehr. Kinder schliefen dort, wo sie gerade waren. Auf der StraÃŸe hupten die Autos, die in die stehengebliebenen Tische krachten.</p>
                <p>â€Wo sind die Kinder?â€œ<br>â€Wer hat meinen Stubentisch ruiniert?â€œ<br>â€Wo ist mein Geld?â€œ<br>â€Wo ist die Polizei?â€œ</p>
                <p>Aber unter der Polizeinummer meldete sich niemand. Wenn es keine Regeln gibt, braucht es niemanden, der sie schÃ¼tzt. Noch in derselben Nacht begann eine Kirchenglocke zu lÃ¤uten. Die Leute eilten zusammen, und einer rief: â€So kÃ¶nnen wir nicht leben!â€œ. â€Nein, so kÃ¶nnen wir nicht leben!â€œ riefen alle zurÃ¼ck. <strong>Wir brauchen wieder Regeln!</strong> Und sie begannen, neue Regeln aufzustellen.</p>
            </div>

            <div class="relative">
                <label class="block text-slate-800 dark:text-slate-200 font-bold mb-3 text-lg">Arbeitsauftrag: Die Funktionen des Rechts</label>
                <p class="text-slate-600 dark:text-slate-400 mb-4 text-base">Warum ging das Experiment im Dorf schief? Notiere in eigenen Worten 2-3 Aufgaben, die Gesetze in einer Gesellschaft erfÃ¼llen mÃ¼ssen (z.B. Schutz vor...).</p>
                <textarea class="w-full h-32 p-5 text-base bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 rounded-2xl focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 outline-none transition-all resize-y save-trigger shadow-sm" data-id="einstieg" placeholder="Wir brauchen Gesetze und Regeln, damit..."></textarea>
                <span class="save-badge hidden absolute bottom-4 right-4 text-green-500 font-bold bg-white/90 dark:bg-slate-800/90 px-3 py-1 rounded-full shadow-sm backdrop-blur"><i class="fa-solid fa-check mr-1"></i>Gespeichert</span>
            </div>
            
            <details class="mt-4 text-sm group">
                <summary class="cursor-pointer text-amber-600 dark:text-amber-400 font-semibold list-none flex items-center"><i class="fa-regular fa-lightbulb mr-2"></i>ğŸ’¡ Tipp anzeigen</summary>
                <div class="p-4 bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-200 rounded-xl mt-2 border border-amber-100 dark:border-amber-800/50 leading-relaxed text-base">
                    <strong>Tipp:</strong> Denke an das geklaute Geld (Eigentum schÃ¼tzen), die gebrochene Nase (KÃ¶rper schÃ¼tzen / Rache vermeiden) und das Chaos auf den StraÃŸen (Ordnung schaffen). Das nennt man in der Fachsprache <strong>Schutzfunktion, Friedensfunktion und Ordnungsfunktion</strong>.
                </div>
            </details>
        </section>

        <!-- Intro JuSchG -->
        <section class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 md:p-10 mb-8 transition-colors">
            <h2 class="text-2xl font-bold mb-5 flex items-center"><span class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 w-10 h-10 rounded-xl flex items-center justify-center mr-4"><i class="fa-solid fa-scale-balanced"></i></span>Das Jugendschutzgesetz (JuSchG)</h2>
            <div class="prose dark:prose-invert max-w-none text-slate-600 dark:text-slate-300 text-base md:text-lg leading-relaxed space-y-4">
                <p>Jetzt wissen wir, warum wir Gesetze brauchen. Ein ganz spezielles Gesetz, das fÃ¼r euch relevant ist, ist das Jugendschutzgesetz (JuSchG). Seine Hauptaufgabe ist die <strong>Schutzfunktion</strong>: Es soll Kinder und Jugendliche vor GefÃ¤hrdungen in der Ã–ffentlichkeit schÃ¼tzen.</p>
                <p>Wichtig: Es dient <strong>nicht</strong> dazu, euch zu bestrafen! Es richtet sich an Gewerbetreibende (z.B. Kinobetreiber, SupermÃ¤rkte, Gastwirte) â€“ sie sind die sogenannten <strong>Normadressaten</strong>. Wenn ein GeschÃ¤ft gegen diese Regeln verstÃ¶ÃŸt, drohen den Betreibern hohe BuÃŸgelder.</p>
            </div>
        </section>

        <!-- Begriffsdefinitionen -->
        <section class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 md:p-10 mb-8 transition-colors">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4">
                <h2 class="text-2xl font-bold flex items-center"><span class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 w-10 h-10 rounded-xl flex items-center justify-center mr-4"><i class="fa-solid fa-puzzle-piece"></i></span>Die wichtigsten Begriffe</h2>
                <span class="text-sm font-semibold bg-blue-50 dark:bg-slate-700 text-blue-600 dark:text-blue-300 border border-blue-200 dark:border-slate-600 py-2 px-4 rounded-full flex items-center shadow-sm"><i class="fa-regular fa-hand-pointer mr-2 text-lg animate-bounce"></i>Tippen zum Zuweisen</span>
            </div>
            
            <div class="flex flex-wrap gap-3 mb-8 bg-slate-50 dark:bg-slate-900/50 p-4 rounded-2xl border border-slate-100 dark:border-slate-700" id="term-container">
                <div class="term-item bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 rounded-xl py-3 px-5 font-semibold text-center flex-grow sm:flex-grow-0" data-term="Personensorgeberechtigter">Personensorgeberechtigter</div>
                <div class="term-item bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 rounded-xl py-3 px-5 font-semibold text-center flex-grow sm:flex-grow-0" data-term="Erziehungsbeauftragter">Erziehungsbeauftragter</div>
                <div class="term-item bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 rounded-xl py-3 px-5 font-semibold text-center flex-grow sm:flex-grow-0" data-term="BildtrÃ¤ger">BildtrÃ¤ger (USK/FSK)</div>
                <div class="term-item bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 rounded-xl py-3 px-5 font-semibold text-center flex-grow sm:flex-grow-0" data-term="Kind">Kind (i.S.d. JuSchG)</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div class="border border-slate-200 dark:border-slate-700 rounded-2xl p-5 shadow-sm flex flex-col">
                    <p class="text-slate-600 dark:text-slate-300 mb-4 flex-grow text-base">Jede Person Ã¼ber 18 Jahren, die aufgrund einer Vereinbarung mit den Eltern fÃ¼r diesen Abend Erziehungsaufgaben wahrnimmt (oft "Muttizettel").</p>
                    <div class="drop-zone border-2 border-dashed border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900/50 rounded-xl flex items-center justify-center text-slate-400 font-medium" data-target="Erziehungsbeauftragter">Hier ablegen</div>
                </div>
                <div class="border border-slate-200 dark:border-slate-700 rounded-2xl p-5 shadow-sm flex flex-col">
                    <p class="text-slate-600 dark:text-slate-300 mb-4 flex-grow text-base">Wem allein oder gemeinsam mit einer anderen Person die Personensorge gesetzlich zusteht (in der Regel sind das die Eltern).</p>
                    <div class="drop-zone border-2 border-dashed border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900/50 rounded-xl flex items-center justify-center text-slate-400 font-medium" data-target="Personensorgeberechtigter">Hier ablegen</div>
                </div>
                <div class="border border-slate-200 dark:border-slate-700 rounded-2xl p-5 shadow-sm flex flex-col">
                    <p class="text-slate-600 dark:text-slate-300 mb-4 flex-grow text-base">Personen, die noch nicht 14 Jahre alt sind. Sie unterliegen dem strengsten Schutzmechanismus im Gesetz.</p>
                    <div class="drop-zone border-2 border-dashed border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900/50 rounded-xl flex items-center justify-center text-slate-400 font-medium" data-target="Kind">Hier ablegen</div>
                </div>
                <div class="border border-slate-200 dark:border-slate-700 rounded-2xl p-5 shadow-sm flex flex-col">
                    <p class="text-slate-600 dark:text-slate-300 mb-4 flex-grow text-base">Physische Speichermedien (wie DVDs, Blu-rays, Konsolen-Spiele auf Cartridge), die Filme oder Videospiele enthalten.</p>
                    <div class="drop-zone border-2 border-dashed border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900/50 rounded-xl flex items-center justify-center text-slate-400 font-medium" data-target="BildtrÃ¤ger">Hier ablegen</div>
                </div>
            </div>
        </section>

        <!-- Gesetzestexte -->
        <section class="bg-slate-800 dark:bg-slate-900 rounded-3xl shadow-lg border border-slate-700 p-6 md:p-10 mb-8 text-white">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold flex items-center"><span class="bg-slate-700 text-blue-400 w-10 h-10 rounded-xl flex items-center justify-center mr-4"><i class="fa-solid fa-book-bookmark"></i></span>Gesetzes-Recherche</h2>
                <!-- ğŸ”Š TTS Info -->
                <span class="text-slate-400 text-sm hidden sm:inline"><i class="fa-solid fa-volume-high mr-1"></i> Auf den Lautsprecher tippen zum Vorlesen</span>
            </div>
            
            <div class="space-y-4">
                <details class="group bg-slate-700/50 rounded-2xl overflow-hidden border border-slate-600/50 open:bg-slate-700 transition-all">
                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-5 hover:bg-slate-600/50 transition-colors text-lg">
                        <span class="flex items-center"><i class="fa-solid fa-utensils w-6 text-slate-400 mr-3"></i> Â§ 4 GaststÃ¤tten</span>
                        <div class="flex items-center gap-3">
                            <button class="tts-btn bg-slate-800 hover:bg-blue-600 text-slate-300 w-10 h-10 rounded-full flex items-center justify-center transition" data-read="law1" title="Vorlesen"><i class="fa-solid fa-volume-high"></i></button>
                            <span class="transition group-open:rotate-180 bg-slate-800 w-10 h-10 rounded-full flex items-center justify-center"><i class="fa-solid fa-chevron-down text-slate-400"></i></span>
                        </div>
                    </summary>
                    <div id="law1" class="text-slate-300 text-base leading-relaxed p-6 bg-slate-800/80 border-t border-slate-600/50">
                        Absatz 1: Der Aufenthalt in GaststÃ¤tten darf Kindern und Jugendlichen unter 16 Jahren nur gestattet werden, wenn eine personensorgeberechtigte oder erziehungsbeauftragte Person sie begleitet oder wenn sie in der Zeit zwischen 5 Uhr und 23 Uhr eine Mahlzeit oder ein GetrÃ¤nk einnehmen.
                        Absatz 2: Jugendlichen ab 16 Jahren darf der Aufenthalt in GaststÃ¤tten ohne Begleitung einer personensorgeberechtigten oder erziehungsbeauftragten Person in der Zeit von 24 Uhr und 5 Uhr morgens nicht gestattet werden.
                    </div>
                </details>

                <details class="group bg-slate-700/50 rounded-2xl overflow-hidden border border-slate-600/50 open:bg-slate-700 transition-all">
                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-5 hover:bg-slate-600/50 transition-colors text-lg">
                        <span class="flex items-center"><i class="fa-solid fa-music w-6 text-slate-400 mr-3"></i> Â§ 5 Tanzveranstaltungen (Clubs)</span>
                        <div class="flex items-center gap-3">
                            <button class="tts-btn bg-slate-800 hover:bg-blue-600 text-slate-300 w-10 h-10 rounded-full flex items-center justify-center transition" data-read="law2"><i class="fa-solid fa-volume-high"></i></button>
                            <span class="transition group-open:rotate-180 bg-slate-800 w-10 h-10 rounded-full flex items-center justify-center"><i class="fa-solid fa-chevron-down text-slate-400"></i></span>
                        </div>
                    </summary>
                    <div id="law2" class="text-slate-300 text-base leading-relaxed p-6 bg-slate-800/80 border-t border-slate-600/50">
                        Absatz 1: Die Anwesenheit bei Ã¶ffentlichen Tanzveranstaltungen darf Kindern und Jugendlichen unter 16 Jahren nicht und Jugendlichen ab 16 Jahren lÃ¤ngstens bis 24 Uhr gestattet werden. Ausnahme: Begleitung durch Erziehungsbeauftragte.
                        Absatz 2: Ausnahme: Anwesenheit fÃ¼r Kinder bis 22 Uhr und Jugendliche unter 16 bis 24 Uhr gestattet, wenn die Veranstaltung von einem anerkannten TrÃ¤ger der Jugendhilfe durchgefÃ¼hrt wird (z.B. Jugendzentrum).
                    </div>
                </details>
                
                <details class="group bg-slate-700/50 rounded-2xl overflow-hidden border border-slate-600/50 open:bg-slate-700 transition-all">
                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-5 hover:bg-slate-600/50 transition-colors text-lg">
                        <span class="flex items-center"><i class="fa-solid fa-gamepad w-6 text-slate-400 mr-3"></i> Â§ 11 & Â§ 12 Filme & Videospiele</span>
                        <div class="flex items-center gap-3">
                            <button class="tts-btn bg-slate-800 hover:bg-blue-600 text-slate-300 w-10 h-10 rounded-full flex items-center justify-center transition" data-read="law3"><i class="fa-solid fa-volume-high"></i></button>
                            <span class="transition group-open:rotate-180 bg-slate-800 w-10 h-10 rounded-full flex items-center justify-center"><i class="fa-solid fa-chevron-down text-slate-400"></i></span>
                        </div>
                    </summary>
                    <div id="law3" class="text-slate-300 text-base leading-relaxed p-6 bg-slate-800/80 border-t border-slate-600/50">
                        Kino Paragraph 11: Kinder und Jugendliche dÃ¼rfen nur Filme sehen, die fÃ¼r ihr Alter freigegeben sind, also FSK beachten. Zudem gelten Zeitgrenzen ohne Begleitung: Unter 14 bis 20 Uhr, unter 16 bis 22 Uhr, unter 18 bis 24 Uhr.
                        BildtrÃ¤ger Paragraph 12: Videospiele und Filme auf DatentrÃ¤gern dÃ¼rfen im Verkauf nur zugÃ¤nglich gemacht werden, wenn diese fÃ¼r die Altersstufe freigegeben sind (USK/FSK).
                    </div>
                </details>
            </div>
        </section>

        <!-- Ampel-Matrix -->
        <section class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 md:p-10 mb-8 overflow-hidden">
            <h2 class="text-2xl font-bold mb-4 flex items-center"><span class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 w-10 h-10 rounded-xl flex items-center justify-center mr-4"><i class="fa-solid fa-table-cells"></i></span>Gesetzes-Matrix</h2>
            <div class="flex flex-wrap items-center gap-4 text-slate-600 dark:text-slate-300 mb-6 text-sm bg-slate-50 dark:bg-slate-900 p-3 rounded-xl border border-slate-100 dark:border-slate-700">
                <span class="flex items-center"><span class="w-4 h-4 rounded-full bg-red-200 border-2 border-red-500 mr-2"></span> Verboten</span>
                <span class="flex items-center"><span class="w-4 h-4 rounded-full bg-green-200 border-2 border-green-500 mr-2"></span> Erlaubt</span>
                <span class="flex items-center"><span class="w-4 h-4 rounded-full bg-yellow-200 border-2 border-yellow-500 mr-2"></span> Bedingt (z.B. Uhrzeit/Begleitung)</span>
            </div>

            <div class="overflow-x-auto -mx-6 px-6 md:mx-0 md:px-0" style="-webkit-overflow-scrolling: touch;">
                <table class="w-full text-left border-collapse min-w-[700px]">
                    <thead>
                        <tr class="bg-slate-100/50 dark:bg-slate-700 text-slate-700 dark:text-slate-200 text-sm font-semibold border-b-2 border-slate-200 dark:border-slate-600">
                            <th class="p-4 w-2/5">Situation / Aufenthaltsort</th>
                            <th class="p-4 text-center">Unter 14</th>
                            <th class="p-4 text-center">14 bis 15</th>
                            <th class="p-4 text-center">16 bis 17</th>
                        </tr>
                    </thead>
                    <tbody id="matrix-body" class="divide-y divide-slate-100 dark:divide-slate-700">
                        <!-- Generiert via JS -->
                    </tbody>
                </table>
            </div>

            <div class="mt-8 flex flex-col md:flex-row items-center justify-between bg-slate-50 dark:bg-slate-900/50 p-4 rounded-2xl border border-slate-200 dark:border-slate-700">
                <button id="checkMatrixBtn" class="bg-slate-800 dark:bg-blue-600 hover:bg-slate-700 dark:hover:bg-blue-500 active:scale-95 text-white font-semibold py-3 px-6 rounded-xl shadow-md transition-all flex items-center justify-center w-full md:w-auto mb-3 md:mb-0">
                    <i class="fa-solid fa-check-double mr-2"></i> Matrix Ã¼berprÃ¼fen
                </button>
                <div id="matrixFeedback" class="text-base font-medium px-4 text-center text-slate-500 dark:text-slate-400">
                    Tippe auf den Button, um deine Eingaben zu testen.
                </div>
            </div>
        </section>

        <!-- Fallstudien -->
        <section class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 md:p-10 mb-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center"><span class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 w-10 h-10 rounded-xl flex items-center justify-center mr-4"><i class="fa-solid fa-gavel"></i></span>FÃ¤lle aus dem Alltag</h2>
            
            <div class="space-y-10" id="cases-container">
                <!-- Case 1 -->
                <div class="case-block">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-xl font-bold">Fall 1: Der Trick im Elektromarkt</h3>
                        <button class="tts-btn text-blue-500 hover:bg-blue-50 dark:hover:bg-slate-700 w-10 h-10 rounded-full transition" data-read="falltext1"><i class="fa-solid fa-volume-high"></i></button>
                    </div>
                    <div id="falltext1" class="bg-slate-50 dark:bg-slate-900/50 p-5 rounded-2xl border border-slate-200 dark:border-slate-700 mb-4 text-base leading-relaxed">
                        Max (15) und sein Bruder Hans (18) sind im Elektromarkt. Max mÃ¶chte einen Ego-Shooter (USK ab 18). Der VerkÃ¤ufer verweigert den Verkauf an Max. Vor den Augen des VerkÃ¤ufers gibt Max Hans das Geld. Hans kauft das Spiel und gibt es Max sofort im Laden.
                    </div>
                    <div class="relative">
                        <textarea class="w-full h-32 p-5 text-base bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 rounded-2xl focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 outline-none transition-all resize-y save-trigger shadow-sm" data-id="fall1" placeholder="Wer hat das Gesetz gebrochen? Max, Hans oder der VerkÃ¤ufer? BegrÃ¼nde."></textarea>
                        <!-- ğŸ’¾ Auto-Save Feedback -->
                        <span class="save-badge hidden absolute bottom-4 right-4 text-green-500 font-bold bg-white/90 dark:bg-slate-800/90 px-3 py-1 rounded-full shadow-sm backdrop-blur"><i class="fa-solid fa-check mr-1"></i>Gespeichert</span>
                    </div>
                    <!-- ğŸ’¡ Tipp System -->
                    <details class="mt-3 text-sm group">
                        <summary class="cursor-pointer text-blue-600 dark:text-blue-400 font-semibold list-none flex items-center"><i class="fa-regular fa-lightbulb mr-2"></i>ğŸ’¡ Tipp anzeigen</summary>
                        <div class="p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-xl mt-2 border border-blue-100 dark:border-blue-800/50">
                            <strong>Tipp:</strong> Schau dir Â§ 12 nochmal an. Darf der VerkÃ¤ufer das Spiel dem 18-jÃ¤hrigen Bruder geben, wenn er ganz genau sieht, dass es eigentlich fÃ¼r den 15-jÃ¤hrigen Max ist? Wer ist hier der Gewerbetreibende (Normadressat)?
                        </div>
                    </details>
                </div>

                <!-- Case 2 -->
                <div class="case-block">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-xl font-bold">Fall 2: Pizza nach dem Training</h3>
                        <button class="tts-btn text-blue-500 hover:bg-blue-50 dark:hover:bg-slate-700 w-10 h-10 rounded-full transition" data-read="falltext2"><i class="fa-solid fa-volume-high"></i></button>
                    </div>
                    <div id="falltext2" class="bg-slate-50 dark:bg-slate-900/50 p-5 rounded-2xl border border-slate-200 dark:border-slate-700 mb-4 text-base leading-relaxed">
                        Felix (14) und Tom (15) gehen nach dem FuÃŸballtraining donnerstags um 21:30 Uhr in eine Pizzeria. Sie bestellen Pizza. Um 23:15 Uhr sitzen sie immer noch dort. Der Wirt lÃ¤sst sie gewÃ¤hren.
                    </div>
                    <div class="relative">
                        <textarea class="w-full h-32 p-5 text-base bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 rounded-2xl focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 outline-none transition-all resize-y save-trigger shadow-sm" data-id="fall2" placeholder="DÃ¼rfen die beiden um diese Uhrzeit noch in der Pizzeria sitzen?"></textarea>
                        <span class="save-badge hidden absolute bottom-4 right-4 text-green-500 font-bold bg-white/90 dark:bg-slate-800/90 px-3 py-1 rounded-full shadow-sm backdrop-blur"><i class="fa-solid fa-check mr-1"></i>Gespeichert</span>
                    </div>
                    <details class="mt-3 text-sm group">
                        <summary class="cursor-pointer text-blue-600 dark:text-blue-400 font-semibold list-none flex items-center"><i class="fa-regular fa-lightbulb mr-2"></i>ğŸ’¡ Tipp anzeigen</summary>
                        <div class="p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-xl mt-2 border border-blue-100 dark:border-blue-800/50">
                            <strong>Tipp:</strong> Lies Â§ 4 Abs. 1 ganz genau. Da gibt es eine feste Uhrzeit-Grenze fÃ¼r Jugendliche unter 16 Jahren beim Einnehmen einer Mahlzeit.
                        </div>
                    </details>
                </div>

                <!-- Case 3 -->
                <div class="case-block">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-xl font-bold">Fall 3: Die Disconacht</h3>
                        <button class="tts-btn text-blue-500 hover:bg-blue-50 dark:hover:bg-slate-700 w-10 h-10 rounded-full transition" data-read="falltext3"><i class="fa-solid fa-volume-high"></i></button>
                    </div>
                    <div id="falltext3" class="bg-slate-50 dark:bg-slate-900/50 p-5 rounded-2xl border border-slate-200 dark:border-slate-700 mb-4 text-base leading-relaxed">
                        Sarah (16) geht samstags mit 18-jÃ¤hrigen Freundinnen in den Club "Nachtflug". Sie hat keinen Erziehungsbeauftragten ("Muttizettel") dabei. Um 01:30 Uhr gibt es eine Polizeikontrolle.
                    </div>
                    <div class="relative">
                        <textarea class="w-full h-32 p-5 text-base bg-white dark:bg-slate-900 border-2 border-slate-200 dark:border-slate-700 rounded-2xl focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-500 outline-none transition-all resize-y save-trigger shadow-sm" data-id="fall3" placeholder="Was passiert bei der Kontrolle? Bekommt Sarah eine Strafe oder der Club-Betreiber?"></textarea>
                        <span class="save-badge hidden absolute bottom-4 right-4 text-green-500 font-bold bg-white/90 dark:bg-slate-800/90 px-3 py-1 rounded-full shadow-sm backdrop-blur"><i class="fa-solid fa-check mr-1"></i>Gespeichert</span>
                    </div>
                    <details class="mt-3 text-sm group">
                        <summary class="cursor-pointer text-blue-600 dark:text-blue-400 font-semibold list-none flex items-center"><i class="fa-regular fa-lightbulb mr-2"></i>ğŸ’¡ Tipp anzeigen</summary>
                        <div class="p-4 bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded-xl mt-2 border border-blue-100 dark:border-blue-800/50">
                            <strong>Tipp:</strong> Bis wann dÃ¼rfen 16-JÃ¤hrige laut Â§ 5 Abs. 1 in eine Disco? Und wer wird bestraft, wenn sich nicht an das Jugendschutzgesetz gehalten wird (Stichwort: Normadressat)?
                        </div>
                    </details>
                </div>
            </div>
        </section>

        <!-- Quiz -->
        <section class="bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 md:p-10 mb-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center"><span class="bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 w-10 h-10 rounded-xl flex items-center justify-center mr-4"><i class="fa-solid fa-list-check"></i></span>Wissens-Check</h2>
            
            <div class="space-y-8" id="quiz-container">
                <div class="quiz-item" data-id="q1">
                    <div class="flex items-start justify-between mb-4">
                        <p id="quiztext1" class="font-semibold text-lg pr-4">1. Gilt das Jugendschutzgesetz auch bei einem privaten Filmabend (Filme ab 18) zu Hause bei einem 15-JÃ¤hrigen ohne Eltern?</p>
                        <button class="tts-btn text-blue-500 flex-shrink-0" data-read="quiztext1"><i class="fa-solid fa-volume-high"></i></button>
                    </div>
                    <div class="space-y-3 relative">
                        <label class="flex items-start space-x-4 p-4 border-2 border-slate-100 dark:border-slate-700 rounded-2xl cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-all shadow-sm">
                            <input type="radio" name="q2" value="A" class="mt-1 quiz-radio save-trigger flex-shrink-0">
                            <span class="text-base pt-0.5">Nein, das Gesetz greift primÃ¤r im Ã¶ffentlichen Raum und GeschÃ¤ftsverkehr, nicht im privaten Wohnzimmer.</span>
                        </label>
                        <label class="flex items-start space-x-4 p-4 border-2 border-slate-100 dark:border-slate-700 rounded-2xl cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-all shadow-sm">
                            <input type="radio" name="q2" value="B" class="mt-1 quiz-radio save-trigger flex-shrink-0">
                            <span class="text-base pt-0.5">Ja, das Gesetz gilt strengstens Ã¼berall. Die Polizei darf deshalb auch private Wohnungen kontrollieren.</span>
                        </label>
                        <span class="save-badge hidden absolute bottom-4 right-4 text-green-500 font-bold bg-white/90 dark:bg-slate-800/90 px-3 py-1 rounded-full shadow-sm backdrop-blur z-10"><i class="fa-solid fa-check mr-1"></i>Gespeichert</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reset Button -->
        <div class="text-center mt-12 mb-24 no-print">
            <button onclick="if(confirm('MÃ¶chtest du wirklich alle Eingaben auf diesem GerÃ¤t lÃ¶schen?')) { localStorage.clear(); location.reload(); }" class="text-red-500 dark:text-red-400 hover:text-red-700 bg-red-50 dark:bg-red-900/20 py-2 px-6 rounded-full text-sm font-semibold transition-colors">
                <i class="fa-solid fa-trash-can mr-2"></i> FÃ¼r den nÃ¤chsten SchÃ¼ler zurÃ¼cksetzen
            </button>
        </div>

    </main>

    <!-- PDF Export Button -->
    <div class="fixed bottom-0 left-0 w-full bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl border-t border-slate-200 dark:border-slate-800 p-4 pb-safe flex justify-center shadow-[0_-10px_15px_-3px_rgba(0,0,0,0.05)] no-print z-40">
        <button id="generatePdfBtn" class="bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-bold text-lg py-4 px-10 rounded-2xl shadow-lg shadow-blue-500/30 transition-all transform hover:-translate-y-1 active:scale-95 flex items-center w-full max-w-md justify-center">
            <i class="fa-solid fa-file-pdf mr-3 text-xl"></i>
            Als PDF exportieren
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DATA & SETUP ---
            const STORAGE_KEY = 'juschg_student_data_v6';
            let appData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
                terms: {}, matrix: {}, cases: {}, quiz: {}, matrixChecked: false, theme: 'light'
            };

            const saveData = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));

            // --- ğŸŒ™ DARK MODE LOGIC ---
            const htmlTag = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');
            
            if(appData.theme === 'dark') htmlTag.classList.add('dark');
            
            themeToggle.addEventListener('click', () => {
                htmlTag.classList.toggle('dark');
                appData.theme = htmlTag.classList.contains('dark') ? 'dark' : 'light';
                saveData();
            });

            // --- ğŸ”Š TEXT-TO-SPEECH (Vorlesen) ---
            document.querySelectorAll('.tts-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if ('speechSynthesis' in window) {
                        window.speechSynthesis.cancel();
                        const textId = btn.getAttribute('data-read');
                        const text = document.getElementById(textId).innerText;
                        
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = 'de-DE';
                        utterance.rate = 0.95; 
                        
                        window.speechSynthesis.speak(utterance);
                        
                        const icon = btn.querySelector('i');
                        icon.classList.remove('fa-volume-high');
                        icon.classList.add('fa-volume-up', 'text-green-400');
                        utterance.onend = () => {
                            icon.classList.add('fa-volume-high');
                            icon.classList.remove('fa-volume-up', 'text-green-400');
                        }
                    } else {
                        alert("Dein Browser unterstÃ¼tzt das Vorlesen leider nicht.");
                    }
                });
            });

            // --- ğŸ† FORTSCHRITTSBALKEN ---
            const progressBar = document.getElementById('progress-bar');
            let hasWon = false;

            const updateProgress = () => {
                let score = 0;
                let termsCount = Object.values(appData.terms).filter(v => v).length;
                score += (termsCount / 4) * 20;
                
                if(appData.matrixChecked) score += 30;
                
                // Wir haben jetzt 4 Textfelder (1x Einstieg, 3x FÃ¤lle)
                let casesCount = Object.values(appData.cases).filter(v => v && v.trim().length > 10).length;
                score += (casesCount / 4) * 40; 
                
                if(appData.quiz['q2']) score += 10;

                progressBar.style.width = `${Math.min(score, 100)}%`;

                if(score >= 100 && !hasWon) {
                    hasWon = true;
                    setTimeout(() => {
                        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, zIndex: 9999 });
                    }, 500);
                }
            };

            // --- ğŸ’¾ AUTO-SAVE FEEDBACK ---
            let typingTimer;
            const showSaveBadge = (element) => {
                const container = element.closest('.relative');
                if(!container) return;
                const badge = container.querySelector('.save-badge');
                if(!badge) return;
                
                clearTimeout(typingTimer);
                badge.classList.remove('hidden', 'fade-out');
                
                typingTimer = setTimeout(() => {
                    badge.classList.add('fade-out');
                    setTimeout(() => badge.classList.add('hidden'), 1000);
                }, 1500);
            };

            // --- MATRIX GENERATION ---
            const matrixRows =[
                { id: "m_gast", label: "Â§ 4 GaststÃ¤tten" }, { id: "m_disco", label: "Â§ 5 Disco/Club" },
                { id: "m_brauchtum", label: "Â§ 5 Jugendverein" }, { id: "m_spiel", label: "Â§ 6 Spielhallen" },
                { id: "m_kino", label: "Â§ 11 Kino" }, { id: "m_medien", label: "Â§ 12 Spiele kaufen" }
            ];
            const states =['state-neutral', 'state-green', 'state-yellow', 'state-red'];
            const stateLabels = { 'state-neutral': 'Tippen', 'state-green': 'Erlaubt', 'state-yellow': 'Bedingt', 'state-red': 'Verboten' };
            const matrixBody = document.getElementById('matrix-body');

            matrixRows.forEach((row) => {
                const tr = document.createElement('tr');
                let cellsHtml = `<td class="p-4 font-medium">${row.label}</td>`;['u14', 'u16', 'u18'].forEach(ageGroup => {
                    const cellId = `${row.id}_${ageGroup}`;
                    const savedState = appData.matrix[cellId] || 0;
                    cellsHtml += `
                        <td class="p-2 text-center border-l border-slate-100 dark:border-slate-700">
                            <div class="traffic-light w-full max-w-[100px] mx-auto h-12 rounded-full flex items-center justify-center font-bold text-sm tracking-wide ${states[savedState]}" 
                                 data-id="${cellId}" data-state="${savedState}">
                                 ${stateLabels[states[savedState]]}
                            </div>
                        </td>`;
                });
                tr.innerHTML = cellsHtml;
                matrixBody.appendChild(tr);
            });

            document.querySelectorAll('.traffic-light').forEach(el => {
                el.addEventListener('pointerdown', function(e) {
                    e.preventDefault();
                    let currentState = parseInt(this.getAttribute('data-state'));
                    let nextState = (currentState + 1) % states.length;
                    
                    this.classList.remove(...states, 'ring-4', 'ring-red-400', 'ring-green-400');
                    this.classList.add(states[nextState]);
                    this.setAttribute('data-state', nextState);
                    this.innerText = stateLabels[states[nextState]];
                    
                    appData.matrix[this.getAttribute('data-id')] = nextState;
                    appData.matrixChecked = false;
                    saveData(); updateProgress();
                });
            });

            const correctMatrixAnswers = {
                'm_gast_u14': 2, 'm_gast_u16': 2, 'm_gast_u18': 2, 
                'm_disco_u14': 3, 'm_disco_u16': 3, 'm_disco_u18': 2, 
                'm_brauchtum_u14': 2, 'm_brauchtum_u16': 2, 'm_brauchtum_u18': 1,
                'm_spiel_u14': 3, 'm_spiel_u16': 3, 'm_spiel_u18': 3, 
                'm_kino_u14': 2, 'm_kino_u16': 2, 'm_kino_u18': 2, 
                'm_medien_u14': 2, 'm_medien_u16': 2, 'm_medien_u18': 2 
            };

            document.getElementById('checkMatrixBtn').addEventListener('pointerdown', function(e) {
                e.preventDefault();
                let correctCount = 0;
                let totalCount = Object.keys(correctMatrixAnswers).length;
                let isComplete = true;

                document.querySelectorAll('.traffic-light').forEach(el => {
                    const id = el.getAttribute('data-id');
                    const currentState = parseInt(el.getAttribute('data-state'));
                    if(currentState === 0) isComplete = false;
                    el.classList.remove('ring-4', 'ring-red-400', 'ring-green-400', 'animate-shake');
                    
                    const correctState = correctMatrixAnswers[id];
                    let isCorrect = (currentState === correctState) || 
                                    (id.startsWith('m_disco_u1') && currentState === 2) || 
                                    (id === 'm_brauchtum_u18' && currentState === 2);

                    if(currentState !== 0) {
                        if(isCorrect) {
                            correctCount++; el.classList.add('ring-4', 'ring-green-400');
                        } else {
                            el.classList.add('ring-4', 'ring-red-400', 'animate-shake');
                            setTimeout(() => el.classList.remove('animate-shake'), 400);
                        }
                    }
                });

                const feedbackMsg = document.getElementById('matrixFeedback');
                if(!isComplete) {
                    feedbackMsg.innerHTML = `<span class="text-yellow-600 dark:text-yellow-400 font-bold"><i class="fa-solid fa-circle-exclamation mr-1"></i> FÃ¼lle erst alle Ampeln aus!</span>`;
                } else if(correctCount === totalCount) {
                    feedbackMsg.innerHTML = `<span class="text-green-600 dark:text-green-400 font-bold"><i class="fa-solid fa-party-horn mr-1"></i> Perfekt! Alles richtig.</span>`;
                    appData.matrixChecked = true;
                    saveData(); updateProgress();
                } else {
                    feedbackMsg.innerHTML = `<span class="text-red-600 dark:text-red-400 font-bold"><i class="fa-solid fa-xmark mr-1"></i> ${correctCount}/${totalCount} richtig. Versuche es nochmal!</span>`;
                }
            });

            // --- TERM MATCHING ---
            let selectedTerm = null;
            let selectedTermElement = null;
            const terms = document.querySelectorAll('.term-item');
            const dropZones = document.querySelectorAll('.drop-zone');

            Object.keys(appData.terms).forEach(target => {
                const termValue = appData.terms[target];
                if (termValue) {
                    const zone = document.querySelector(`.drop-zone[data-target="${target}"]`);
                    const termEl = document.querySelector(`.term-item[data-term="${termValue}"]`);
                    if (zone && termEl) {
                        zone.innerHTML = ''; zone.appendChild(termEl);
                        zone.classList.remove('border-dashed', 'text-slate-400', 'bg-slate-50', 'dark:bg-slate-900/50');
                        zone.classList.add('bg-white', 'dark:bg-slate-800', 'border-solid', 'border-blue-200', 'dark:border-blue-800');
                    }
                }
            });

            terms.forEach(term => {
                term.addEventListener('pointerdown', (e) => {
                    e.stopPropagation();
                    if (selectedTermElement) selectedTermElement.classList.remove('selected');
                    selectedTerm = term.getAttribute('data-term');
                    selectedTermElement = term;
                    term.classList.add('selected');
                    dropZones.forEach(dz => dz.classList.add('highlight'));
                    if (navigator.vibrate) navigator.vibrate(50);
                });
            });

            dropZones.forEach(zone => {
                zone.addEventListener('pointerdown', () => {
                    if (selectedTermElement) {
                        zone.innerHTML = ''; zone.appendChild(selectedTermElement);
                        zone.classList.remove('border-dashed', 'text-slate-400', 'highlight', 'bg-slate-50', 'dark:bg-slate-900/50');
                        zone.classList.add('bg-white', 'dark:bg-slate-800', 'border-solid', 'border-blue-200', 'dark:border-blue-800');
                        selectedTermElement.classList.remove('selected');
                        
                        appData.terms[zone.getAttribute('data-target')] = selectedTerm;
                        saveData(); updateProgress();
                        
                        selectedTerm = null; selectedTermElement = null;
                        dropZones.forEach(dz => dz.classList.remove('highlight'));
                    } else if (zone.children.length > 0) {
                        const child = zone.children[0];
                        document.getElementById('term-container').appendChild(child);
                        zone.innerHTML = 'Hier ablegen';
                        zone.classList.add('border-dashed', 'text-slate-400', 'bg-slate-50', 'dark:bg-slate-900/50');
                        zone.classList.remove('bg-white', 'dark:bg-slate-800', 'border-solid', 'border-blue-200', 'dark:border-blue-800');
                        
                        appData.terms[zone.getAttribute('data-target')] = null;
                        saveData(); updateProgress();
                    }
                });
            });

            document.addEventListener('pointerdown', () => {
                if (selectedTermElement) {
                    selectedTermElement.classList.remove('selected');
                    selectedTerm = null; selectedTermElement = null;
                    dropZones.forEach(dz => dz.classList.remove('highlight'));
                }
            });

            // --- TEXTAREAS & QUIZ ---
            document.querySelectorAll('textarea.save-trigger').forEach(ta => {
                if (appData.cases[ta.getAttribute('data-id')]) ta.value = appData.cases[ta.getAttribute('data-id')];
                ta.addEventListener('input', (e) => {
                    appData.cases[e.target.getAttribute('data-id')] = e.target.value;
                    saveData(); updateProgress(); showSaveBadge(e.target);
                });
            });

            document.querySelectorAll('input[type="radio"].save-trigger').forEach(radio => {
                const name = radio.getAttribute('name');
                if (appData.quiz[name] === radio.value) radio.checked = true;
                radio.addEventListener('change', (e) => {
                    appData.quiz[name] = e.target.value;
                    saveData(); updateProgress(); showSaveBadge(e.target);
                });
            });

            if(appData.matrixChecked) document.getElementById('checkMatrixBtn').dispatchEvent(new Event('pointerdown'));
            updateProgress();

            // --- PDF GENERATION ---
            document.getElementById('generatePdfBtn').addEventListener('click', () => {
                const wasDark = htmlTag.classList.contains('dark');
                if(wasDark) htmlTag.classList.remove('dark');
                
                const printContainer = document.getElementById('print-container');
                const date = new Date().toLocaleDateString('de-DE');
                
                let printHtml = `<div style="margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 10px;"><h1 style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">Notizen: Jugendschutzgesetz (JuSchG)</h1><p style="color: #666;">Erstellt am: ${date}</p></div>`;

                // Einstieg in PDF
                printHtml += `<h2 style="font-size: 18px; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #ccc;">1. Einstieg: Funktionen des Rechts</h2>`;
                const einstiegAnswer = appData.cases['einstieg'] || "Keine Notizen eingetragen.";
                printHtml += `<div style="margin-bottom: 25px;"><div style="background: #f9f9f9; padding: 15px; border: 1px solid #ccc; min-height: 80px; font-size: 14px;">${einstiegAnswer.replace(/\n/g, '<br>')}</div></div>`;

                // Matrix in PDF
                printHtml += `<h2 style="font-size: 18px; font-weight: bold; margin-top: 30px; border-bottom: 1px solid #ccc;">2. Ampel-Matrix Auswertung</h2>`;
                printHtml += `<table style="width: 100%; border-collapse: collapse; font-size: 14px; margin-bottom: 30px; margin-top: 15px;"><thead><tr><th style="border: 1px solid #ccc; padding: 8px; text-align: left;">Situation</th><th style="border: 1px solid #ccc; padding: 8px;">Unter 14</th><th style="border: 1px solid #ccc; padding: 8px;">14-15 Jahre</th><th style="border: 1px solid #ccc; padding: 8px;">16-17 Jahre</th></tr></thead><tbody>`;
                
                matrixRows.forEach(row => {
                    printHtml += `<tr><td style="border: 1px solid #ccc; padding: 8px;">${row.label}</td>`;['u14', 'u16', 'u18'].forEach(ageGroup => {
                        const cellId = `${row.id}_${ageGroup}`;
                        const stateValue = appData.matrix[cellId] || 0;
                        const label = stateLabels[states[stateValue]];
                        printHtml += `<td style="border: 1px solid #ccc; padding: 8px; text-align: center;">${label}</td>`;
                    });
                    printHtml += `</tr>`;
                });
                printHtml += `</tbody></table><div class="page-break"></div>`;

                // FÃ¤lle in PDF
                printHtml += `<h2 style="font-size: 18px; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #ccc;">3. Fallstudien</h2>`;
                const cases =[{id: 'fall1', title: 'Fall 1: Der Elektromarkt'},{id: 'fall2', title: 'Fall 2: Pizza nach dem Training'},{id: 'fall3', title: 'Fall 3: Die Disconacht'}];

                cases.forEach((c) => {
                    const answer = appData.cases[c.id] || "Keine Notizen eingetragen.";
                    const formattedAnswer = answer.replace(/\n/g, '<br>');
                    printHtml += `<div style="margin-bottom: 25px;"><h3 style="font-size: 16px; font-weight: bold; margin-bottom: 8px;">${c.title}</h3><div style="background: #f9f9f9; padding: 15px; border: 1px solid #ccc; min-height: 80px; font-size: 14px;">${formattedAnswer}</div></div>`;
                });

                printContainer.innerHTML = printHtml;
                
                window.print();
                
                if(wasDark) setTimeout(() => htmlTag.classList.add('dark'), 1000);
            });

        });
    </script>
</body>
</html>
